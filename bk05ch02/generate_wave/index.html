<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Generator</title>
</head>

<body>
    <h1>WASM Wave Generator</h1>
    <button id="playButton">Play Sine Wave</button>
    <p id="status">Click button to generate and play a sine wave</p>

    <script type="module">
        import init, { generate_wave } from './pkg/generate_wave.js';

        async function run() {
            // Initialize the WASM module
            await init();

            const playButton = document.getElementById('playButton');
            const status = document.getElementById('status');

            playButton.addEventListener('click', async () => {
                try {
                    // Create audio context
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

                    // Generate 44100 samples (1 second at 44.1kHz sample rate)
                    const sampleRate = audioContext.sampleRate;
                    const duration = 1; // seconds
                    const samples = sampleRate * duration;

                    status.textContent = `Generating ${samples} samples...`;

                    // Call WASM function to generate wave data
                    const waveData = generate_wave(samples);

                    // Create audio buffer
                    const audioBuffer = audioContext.createBuffer(1, samples, sampleRate);
                    const channelData = audioBuffer.getChannelData(0);

                    // Copy WASM-generated data into audio buffer
                    channelData.set(waveData);

                    // Create and play audio
                    const source = audioContext.createBufferSource();
                    source.buffer = audioBuffer;
                    source.connect(audioContext.destination);
                    source.start();

                    status.textContent = `Playing sine wave (${samples} samples at ${sampleRate}Hz)`;

                    source.onended = () => {
                        status.textContent = 'Playback finished. Click to play again.';
                    };
                } catch (error) {
                    status.textContent = `Error: ${error.message}`;
                    console.error(error);
                }
            });
        }

        run();
    </script>
</body>

</html>